# JPQL(Java Persistence Query Language)
JPA는 JPQL, JPA Criteria, QueryDSL, 네이티브 SQL 등 다양한 쿼리 방법을 지원한다.

<br>

## JPQL이란
엔티티 객체를 조회하는 객체지향 쿼리
- 데이터베이스 테이블을 대상으로 쿼리하는 것이 아니라 엔티티 객체를 대상으로 쿼리한다.
- JPA는 JPQL을 분석하여 SQL을 생성한 후 데이터베이스에서 조회한다.
- SQL을 추상화 했기 때문에 특정 벤더에 종속적이지 않다.

<br>

## N+1문제란
연관관계가 설정된 엔티티를 조회할 경우 조회된 데이터 개수(n)만큼 연관관계 조회 쿼리가 추가로 발생하여 데이터를 읽어오는 것이다.

### N+1문제가 발생하는 이유
JPQL은 SQL을 추상화한 객체지향 쿼리 언어로 특정 SQL에 종속되지 않고 엔티티 객체와 필드 이름을 가지고 쿼리를 한다. JPQL을 분석해서 SQL을 생성할 때는 글로벌 Fetch 전략을 참고하지 않고 오직 JPQL 객체만을 사용한다.

1. findAll()을 하면 부모 테이블의 SQL문이 생성되어 실행된다.
2. 데이터베이스의 결과를 받아 엔티티의 인스턴스들을 생성한다.
3. 영속성 컨텍스트에서 연관되어 있는 자식 테이블이 있는지 확인한다.
4. 없다면 위에서 만들어진 부모 인스턴스 개수에 맞게 자식 조회 구문이 실행되며 N+1문제가 발생한다.

### N+1문제 해결 방법
Fetch Join, @EntityGraph, Batch Size 등의 방법이 있다.

<br>

출처: https://incheol-jung.gitbook.io/docs/q-and-a/spring/n+1